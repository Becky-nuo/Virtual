ICMP协议：
    定义：
    Internet控制消息协议ICMP ( Internet Control Message Protocol )是网络层的
    一个重要协议，ICMP协议用来在网络设备间传递各种差错和控制信息，并对于收集各种
    网络信息、诊断和排除各种网络故障等方面起着至关重要的作用，使用基于ICMP的应用时，
    需要对ICMP的工作原理非常熟悉；

    ICMP是TCP/IP协议簇的核心协议之一 ，它用于在IP网络设备之间发送控制报文，传递差错、
    控制、查询等信息；


    ICMP重定向：
        ICMP Redirect重定向消息用于支持路由功能，如：主机A希望发送报文到服务器A，
        于是根据配置的默认网关地址向网关RTB发送报文，网关RTB收到报文后，检查报文信息，
        发现报文应该转发到与源主机在同一网段的另一个网关设备RTA，因为此转发路径是更优
        的路径，所以RTB会向主机发送一个Redirect消息，通知主机直接向另一个网关RTA发送该
        报文，主机收到Redirect消息后，会向RTA发送报文，然后RTA会将该报文再转发给服务器A；

    ICMP差错检测：
        IMCP Echo 消息常用于诊断源和目的地之间的网络连通性，同时还可以提供其他信息，如
        报文往返时间等；


    IMCP错误报告：
        ICMP定义了各种错误消息，用于诊断网络连接性问题，根据这些错误消息，源设备可以判
        断出数据传输失败的原因；比如：如果网络中发生了环路，导致报文在网络中循环，且最
        终TTL超时，这种情况下网络设备会发送TTL超时消息给发送端设备，如果目的地不可达，
        则中间的网络设备会发送目的不可达消息给发送端设备，目的不可达的情况有多种，
        如果是网络设备无法找到目的网络,则发送目的网络不可达消息，如果网络设备无法找到
        目的网络中的目的主机，则发送目的主机不可达消息；


    IMCP数据包格式：
        Type表示IMCP消息类型，Code表示同一消息类型中的不同信息；
        消息中包含32 bit 的可变参数，这一字段一般不使用，通常设置为0；


    IMCP消息类型和编码类型：
        ICMP定义了多种消息类型，并用于不同的场景，有些消息不需要Code字段来描述具体类
        型参数，仅用Type字段表示消息类型，比如：ICMP Echo回复消息的Type字段设置为0；
        有些ICMP消息使用Type字段定义消息大类，用Code字段表示消息的具体类型，比如：类
        型为3的消息表示目的不可达，不同的Code值表示不可达的原因，包括目的网络不可达(Co
        de=0)、目的主机不可达(Code=1)、协议不可达(Code=2)、目的TCP/UDP端口不可达(Code=3)等；

    IMCP应用-Ping
        ICMP的一个典型应用是Ping，Ping是检测网络连通性的常用工具，同时也能够收集其他
        相关信息。用户可以在Ping命令中指定不同参数,如ICMP报文长度、发送的ICMP报文个
        数、等待回复响应的超时时间等，设备根据配置的参数来构造并发送ICMP报文，进行Ping
        测试；
        
        Ping常用的配置参数说明如下:
            -a source-ip-address指定发送ICMP ECHO- REQUEST报文的源IP地址，如果不指定源
            IP地址，将采用出接口的IP地址作为ICMP ECHO-REQUEST报文发送的源地址；
            
            -C count指定发送ICMP ECHO-REQUEST报文次数，缺省情况下发送5个ICMP ECHO-
            REQUEST报文；
            
            -h ttl-value指定TTL的值，缺省值是255；
            -t timeout指定发送完ICMP ECHO-REQUEST后，等待ICMP ECHO-REPLY的超时时间；

            Ping命令的输出信息中包括目的地址、IMCP报文长度、序号、TTL值以及往返时间；


    IMCP应用-Tracert：
        ICMP的另一个典型应用是Tracert，Tracert基于报文头中的TTL值来逐跳跟踪报文的转发
        路径，为了跟踪到达某特定目的地址的路径，源端首先将报文的TTL值设置为1.该报文到
        达第一个节点后，TTL超时，于是该节点向源端发送TTL超时消息，消息中携带时间戳；然
        后源端将报文的TTL值设置为2，报文到达第二个节点后超时，该节点同样返回TTL超时消
        息，以此类推，直到报文到达目的地，这样源端根据返回的报文中的信息可以跟踪到报
        文经过的每一个节点，并根据时间戳信息计算往返时间；Tracert是检测网络丢包及时延的
        有效手段；同时可以帮助管理员发现网络中的路由环路；
        
        Tracert常用的配置参数说明如下： 
            -a source-ip-address指定tracert报文的源地址；
            -f first-tt指定初始TTL，缺省值是1；
            -m max-ttI指定最大TTL，缺省值是30；
            -name使能显示每一跳的主机名；
            -P port指定目的主机的UDP端口号；

            Type 表示IMCP消息类型，Code表示同一消息类型中的不同信息；


    总结：
        Ping利用ICMP Echo请求消息( Type值为8 )来发起检测目的可达性，目的端收到ICMP
        Echo请求消息后，根据IP报文头中的源地址向源端发送ICMP Echo回复消息( Type值为0)；

        如果IP数据包在到达目的地之前TTL值已经降为0，则收到P数据包的网络设备会丢弃该数
        据包，并向源端发送ICMP消息通知源端TTL超时；



