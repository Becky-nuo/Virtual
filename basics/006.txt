DHCP原理与配置
DHCP应用场景：
    DHCP服务器能够为大量主机分配IP地址，并能够集中管理

    在大型企业网络中, 一般会有大量的主机等终端设备。每个终端都需要配置IP地址等网络参数才能接入网络。
    在小型网络中,终端数量很少,可以手动配置IP地址。但是在大中型网络中,终端数量很多,手动配置IP地址工作量大,
    而且配置时容易导致IP地址冲突等错误。
    
    DHCP可以为网络终端动态分配IP地址,解决了手工配置IP地址时的各种问题。

DHCP报文类型：

    DHCP客户端初次接入网络时,会发送DHCP发现报文( DHCP Discover) ,用于查找和定位DHCP服务器。
    
    DHCP服务器在收到DHCP发现报文后,发送DHCP提供报文( DHCP Offer) ,此报文中包含IP地址等配置信息。
    
    在DHCP客户端收到服务器发送的DHCP提供报文后,会发送DHCP请求报文( DHCPRequest) ,另外在DHCP客户端
    获取IP地址并重启后,同样也会发送DHCP请求报文,用于确认分配的IP地址等配置信息。DHCP客户端获取的IP
    地址租期快要到期时,也发送DHCP请求报文向服务器申请延长IP地址租期。
    
    收到DHCP客户端发送的DHCP请求报文后, DHCP服务器会回复DHCP确认报文( DHCPACK)。客户端收到DHCP确认报文后,
    会将获取的IP地址等信息进行配置和使用。
    
    如果DHCP服务器收到DHCP- REQUEST报文后,没有找到相应的租约记录,则发送DHCP-NAK报文作为应答,告知DHCP
    客户端无法分配合适IP地址。
   
    DHCP客户端通过发送DHCP释放报文( DHCP Release )来释放IP地址。 收到DHCP释放报文后, 
    DHCP服务器可以把该IP地址分配给其他DHCP客户端。


地址池：
    ARG3系列路由器支持两种地址池：全局地址和接口地址池。

    ARG3系列路由器和X7系列交换机都可以作为DHCP服务器,为主机等设备分配IP地址。DHCP服务器的地址池是用来定
    义分配给主机的IP地址范围,有两种形式。
    
    接口地址池为连接到同一-网段的主机或终端分配IP地址。可以在服务器的接口下执行dhcp select interface命令,
    配置DHCP服务器采用接口地址池的DHCP服务器模式为客户端分配IP地址。
    
    全局地址池为所有连接到DHCP服务器的终端分配IP地址。可以在服务器的接口下执行dhcp select global命令,
    配置DHCP服务器采用全局地址池的DHCP服务器模式为客户端分配IP地址。
    
    接口地址池的优先级比全局地址池高。配置了全局地址池后,如果又在接口_上配置了地址池，客户端将会从接口
    地址池中获取IP地址。在X7系列交换机上,只能在VLANIF逻辑接口上配置接口地址池。


DHCP工作原理：
    为了获取IP地址等配置信息, DHCP客户端需要和DHCP服务器进行报文交互。
    
    DHCP客户端发送DHCP发现报文来发现DHCP服务器。DHCP服务器会选取一个未分配的IP地址,向DHCP客
    户端发送DHCP提供报文,此报文中包含分配给客户端的IP地址和其他配置信息。如果存在多个DHCP服务器,
    每个DHCP服务器都会响应。
    
    如果有多个DHCP服务器向DHCP客户端发送DHCP提供报文, DHCP客户端将会选择收到的第一个DHCP提供报文,
    然后发送DHCP请求报文,报文中包含请求的IP地址。收到DHCP请求报文后,提供该IP地址的DHCP服务器会向DHCP客户
    端发送一个DHCP确认报文，包含提供的IP地址和其他配置信息。DHCP客户端收到DHCP确认报文后,会发送免费ARP报文，
    检查网络中是否有其他主机使用分配的IP地址。如果指定时间内没有收到ARP应答, DHCP客户端会使用这个IP地址。
    
    如果有主机使用该IP地址, DHCP客户端会向DHCP服务器发送DHCP拒绝报文,通知服务器该IP地址已被占用，
    然后DHCP客户端会向服务器重新申请-个IP地址。



DHCP租期更新:
    申请到IP地址后, DHCP客户端中会保存三个定时器,分别用来控制租期更新,租期重绑定
    和租期失效。DHCP服务器为DHCP客户端分配IP地址时会指定3三个定时器的值。如果
    DHCP服务器没有指定定时器的值, DHCP客户端会使用缺省值,缺省租期为1天。默认情
    况下,还剩下50%的租期时, DHCP客户端开始租约更新过程, DHCP客户端向分配IP地址
    的服务器发送DHCP请求报文来申请延长IP地址的租期。DHCP服务器向客户端发送DHCP
    确认报文,给予DHCP客户端一个新的租期。



DHCP接口地址池配置：
    DHCP支持配置两种地址池，包括全局地址池和接口地址池。
    
    dhcp enable命令用来使能DHCP功能。在配置DHCP服务器时,必须先执行dhcp enable
    命令,才能配置DHCP的其他功能并生效。
    
    dhcp select interface命令用来关联接口和接口地址池,为连接到接口的主机提供配置信
    息。在本示例中,接口GigabitEthernet 0/0/0被加入接口地址池中。
    
    dhcp server dns-list命令用来指定接口地址池下的DNS服务器地址。
    
    dhcp server excluded-ip-addres命令用来配置接口地址池中不参与自动分配的IP地址范围。
    
    dhcp server lease命令用来配置DHCP服务器接口地址池中IP地址的租用有效期限功能。缺省情况下,接口地址池中IP地址的租用有效期限为1天。



DHCP全局地址池配置：
    ip pool命令用来创建全局地址池。
    
    network命令用来配置全局地址池下可分配的网段地址。
    
    gateway-list命令用来配置DHCP服务器全局地址池的出口网关地址。
    
    lease命令用来配置DHCP全局地址池下的地址租期。缺省情况下, IP地址租期是1天。
    
    dhcp select global命令用来使能接口的DHCP服务器功能。


总结：
    在IP地址池中,应该排除分配给DNS等服务器的IP地址, DHCP服务器接口的P地址等,避免IP地址冲突。
    默认的IP地址租期是86400秒,即一天。